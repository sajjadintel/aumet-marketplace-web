/*! jQuery Session Timeout - v0.1.0 - 2012-06-30
* https://github.com/asabaylus/jQuery-sessionTimeout
* Copyright (c) 2012 Asa Baylus; Licensed MIT, GPL */
(function(a){var b,c,d,e={},f=[],g=new Date,h="sessionTimeout_"+g.getTime(),i="0.0.1",j,k,l;a.fn.sessionTimeout=function(d,m){function n(b){f.push(b),a(document).trigger("eventLogged.sessionTimeout")}b={autoping:!0,timeout:3e5,resource:"spacer.gif",promptfor:1e4,beforetimeout:a.noop,ontimeout:a.noop},c={_init:function(){window.clearInterval(k),k=window.setInterval(function(){if(d.autoping===!1)if(a.isFunction(d.ontimeout)){d.ontimeout.call(this),window.clearInterval(k);var b=new Date;n("$.fn.sessionTimeout status: session expired @"+b.toTimeString()),a(document).trigger("expired.sessionTimeout")}else a.error("The jQuery.sessionTimeout ontimeout parameter is expecting a function");else c.ping.apply(this,arguments)},d.timeout),d.autoping||(l=window.setTimeout(function(){var b=new Date;n("$.fn.sessionTimeout status: beforeTimeout triggered @"+b.toTimeString()),a.isFunction(d.beforetimeout)?d.beforetimeout.call(this):a.error("The jQuery.sessionTimeout beforetimeout parameter is expecting a function"),a(document).trigger("prompt.sessionTimeout")},d.timeout-d.promptfor)),j=new Date,n("$.fn.sessionTimeout status: initialized"),a(document).trigger("create.sessionTimeout",[i,g,j-g])},ping:function(){var b=new Date,d=b.getTime();if(typeof k=="undefined"){a.error('Initialize $.fn.sessionTimeout before invoking method "ping".');return}c._fetch.apply(),n("$.fn.sessionTimeout status: session restarted @ "+b.toTimeString()),a(document).trigger("ping.sessionTimeout")},_fetch:function(){var b=new Date,c=b.getTime(),e=/^(.+)\.([^\.]*)?$/,f=/^jpg|jpeg|png|gif|bmp$/,g=d.resource.match(e),i=g[2],j=f.test(i);a("#"+h).length?a("#"+h).attr("src",d.resource+"?timestamp="+c):j?a("body").append("<img id='"+h+"' src='"+d.resource+"?tstamp="+c+'\' style=\'position: "absolute", height: "1px", width: "1px"\' alt=\'web page session management helper\'>'):a("body").append("<iframe id='"+h+"' src='"+d.resource+"?tstamp="+c+'\' style=\'position: "absolute", height: "1px", width: "1px", display: "none"\' alt=\'web page session management helper\'></iframe>')},_beforeTimeout:function(){a.isFunction(d.beforetimeout)?l=window.setTimeout(function(){var b=new Date;n("$.fn.sessionTimeout status: beforeTimeout triggered @"+b.toTimeString()),d.beforetimeout.call(this),a(document).trigger("prompt.sessionTimeout")},d.timeout-d.promptfor):a.error("The jQuery.sessionTimeout beforetimeout parameter is expecting a function")},duration:function(){return n("$.fn.sessionTimeout status: duration "+d.timeout),d.timeout},elapsed:function(){var a=new Date-j;return n("$.fn.sessionTimeout status: elapsed "+a+" ms"),a},remaining:function(){var a=new Date,b=new Date(j.getTime()+d.timeout),c=b-a>0?b-a:0;return n("$.fn.sessionTimeout status: remaining "+c+" ms"),c},destroy:function(){typeof j!="undefined"?(a("#"+h).remove(),window.clearInterval(k),window.clearTimeout(l),j=undefined,n("$.fn.sessionTimeout status: destroy"),a(document).trigger("destroy.sessionTimeout"),a(document).unbind("sessionTimeout"),f.length=0):a.error("Could not destroy, initialize the plugin before calling destroy.")},printLog:function(){return f}},c[d]&&(m=d),a.extend(e,d),d=a.extend(b,e);if(c[m])return c[m].apply(this,Array.prototype.slice.call(arguments,1));if(typeof m=="object"||!m)return c._init.apply(this,arguments);a.error("Method "+m+" does not exist on jQuery.sessionTimeout")}})(jQuery);