################################

## 02/02/2021 -- Hamza Rashid

# Added field 'entityImage' to 'vwEntityUserProfile' view
CREATE OR REPLACE VIEW `marketplace`.`vwEntityUserProfile` AS
SELECT `ua`.`userId`                     AS `userId`,
       `u`.`email`                       AS `userEmail`,
       `u`.`fullname`                    AS `userFullName`,
       `u`.`mobile`                      AS `userMobile`,
       `u`.`statusId`                    AS `userStatusId`,
       `u`.`roleId`                      AS `userRoleId`,
       `ua`.`accountId`                  AS `accountId`,
       `a`.`number`                      AS `accountNumber`,
       `a`.`statusId`                    AS `accountStatusId`,
       `ua`.`statusId`                   AS `userAccountStatusId`,
       `a`.`entityId`                    AS `entityId`,
       `e`.`typeId`                      AS `entityTypeId`,
       `e`.`name_en`                     AS `entityName_en`,
       `e`.`name_ar`                     AS `entityName_ar`,
       `e`.`name_fr`                     AS `entityName_fr`,
       `e`.`countryId`                   AS `entityCountryId`,
       `e`.`image`                       AS `entityImage`,
       `marketplace`.`country`.`name_en` AS `entityCountryName_en`,
       `marketplace`.`country`.`name_ar` AS `entityCountryName_ar`,
       `marketplace`.`country`.`name_fr` AS `entityCountryName_fr`,
       `eb`.`id`                         AS `entityBranchId`,
       `eb`.`cityId`                     AS `entityBranchCityId`,
       `marketplace`.`city`.`nameEn`     AS `entityBranchCityName_en`,
       `marketplace`.`city`.`nameAr`     AS `entityBranchCityName_ar`,
       `marketplace`.`city`.`nameFr`     AS `entityBranchCityName_fr`,
       `eb`.`address_en`                 AS `entityBranchAddress_en`,
       `eb`.`address_ar`                 AS `entityBranchAddress_ar`,
       `eb`.`address_fr`                 AS `entityBranchAddress_fr`,
       `eb`.`tradeLicenseNumber`         AS `entityBranchTradeLicenseNumber`,
       `eb`.`tradeLicenseUrl`            AS `entityBranchTradeLicenseUrl`
FROM `marketplace`.`user` `u`
  JOIN `marketplace`.`userAccount` `ua` ON `ua`.`userId` = `u`.`id`
  JOIN `marketplace`.`account` `a` ON `ua`.`accountId` = `a`.`id`
  JOIN `marketplace`.`entity` `e` ON `a`.`entityId` = `e`.`id`
  JOIN `marketplace`.`entityBranch` `eb` ON `a`.`entityId` = `eb`.`entityId`
  LEFT JOIN `marketplace`.`country` ON `marketplace`.`country`.`id` = `e`.`countryId`
  LEFT JOIN `marketplace`.`city` ON `marketplace`.`city`.`id` = `eb`.`cityId`;

################################

## 03/02/2021 -- Antoine Abou Cherfane

# Modified vwEntityProductSellSummary
CREATE OR REPLACE VIEW `marketplace`.`vwEntityProductSellSummary` AS
    SELECT 
        `ep`.`id` AS `id`,
        `ep`.`entityId` AS `entityId`,
        `e`.`name_ar` AS `entityName_ar`,
        `e`.`name_en` AS `entityName_en`,
        `e`.`name_fr` AS `entityName_fr`,
        `ep`.`productId` AS `productId`,
        `p`.`scientificNameId` AS `scientificNameId`,
        `s`.`name` AS `scientificName`,
        `p`.`name_ar` AS `productName_ar`,
        `p`.`name_en` AS `productName_en`,
        `p`.`name_fr` AS `productName_fr`
    FROM
        (((`entityProductSell` `ep`
        JOIN `entity` `e` ON ((`ep`.`entityId` = `e`.`id`)))
        JOIN `product` `p` ON ((`ep`.`productId` = `p`.`id`)))
        JOIN `scientificName` `s` ON ((`p`.`scientificNameId` = `s`.`id`)))
        
################################

## 04/02/2021 -- Sajad Abbasi

INSERT INTO `marketplace`.`paymentMethod` (`name_en`, `name_ar`, `name_fr`) VALUES ('Payment by Credit Facility', 'Payment by Credit Facility', 'Payment by Credit Facility');

ALTER TABLE `marketplace`.`product`
CHANGE COLUMN `description_en` `description_en` TEXT NULL DEFAULT NULL ,
CHANGE COLUMN `description_fr` `description_fr` TEXT NULL DEFAULT NULL ,
CHANGE COLUMN `description_ar` `description_ar` TEXT NULL DEFAULT NULL ;

################################
